WMS.module('Suppliers', function(Suppliers, WMS, Backbone, Marionette, $, _) {  Suppliers.Router = Marionette.AppRouter.extend({    appRoutes: {      "suppliers(/filter/criterion::criterion)": "listSuppliers",      "suppliers/estimates(/id::id)(/code::code)(/supplier::supplier)(/from::from)(/to::to)": "listEstimates",      "suppliers/orders(/id::id)(/code::code)(/supplier::supplier)(/from::from)(/to::to)": "listOrders",      "suppliers/notes(/id::id)(/code::code)(/supplier::supplier)(/from::from)(/to::to)": "listNotes",      "suppliers/invoices(/id::id)(/code::code)(/supplier::supplier)(/from::from)(/to::to)": "listInvoices",      "suppliers/:id": "showSupplier"    },        header: 'suppliers',    permissionsMap: {      'listSuppliers' : 'supplier:list',      'showSupplier'  : 'supplier:retrieve',      'listEstimates' : 'supplierEstimate:list',      'listOrders'    : 'supplierOrder:list',      'listNotes'     : 'supplierNote:list',      'listInvoices'  : 'supplierInvoice:list'    }  });    var controllers = Suppliers.controllers = {}    , API = {    listSuppliers: function(criterion) {      if (!controllers.list) {        controllers.list = new Suppliers.List.Controller();      }      controllers.list.listSuppliers(criterion);    },    showSupplier: function(id) {      if (!controllers.show) {        controllers.show = new Suppliers.Show.Controller();      }      controllers.show.showSupplier(id);    },    listEstimates: function(id, code, supplier, from, to) {      if (!controllers.estimates) {        console.log("creo nuovo Suppliers.Estimates.Controller");        controllers.estimates = new Suppliers.Estimates.Controller();      }      id    = _.isNaN(parseInt(id)) ? null : parseInt(id);      supplier= _.isNaN(parseInt(supplier)) ? null : parseInt(supplier);      from  = Date.parse(from);      to    = Date.parse(to);      controllers.estimates.listEstimates(id, code, supplier, from, to);    },    listOrders: function(id, code, supplier, from, to) {      if (!controllers.orders) {        console.log("creo nuovo Suppliers.Orders.Controller");        controllers.orders = new Suppliers.Orders.Controller();               }      id    = _.isNaN(parseInt(id)) ? null : parseInt(id);      supplier= _.isNaN(parseInt(supplier)) ? null : parseInt(supplier);      from  = Date.parse(from);      to    = Date.parse(to);      controllers.orders.listOrders(id, code, supplier, from, to);    },    listNotes: function(id, code, supplier, from, to) {      if (!controllers.notes) {        controllers.notes = new Suppliers.Notes.Controller();      }      id    = _.isNaN(parseInt(id)) ? null : parseInt(id);      supplier= _.isNaN(parseInt(supplier)) ? null : parseInt(supplier);      from  = Date.parse(from);      to    = Date.parse(to);      controllers.notes.listNotes(id, code, supplier, from, to);    },    listInvoices: function(id, code, supplier, from, to) {      if (!controllers.invoices) {        controllers.invoices = new Suppliers.Invoices.Controller();      }      id    = _.isNaN(parseInt(id)) ? null : parseInt(id);      supplier= _.isNaN(parseInt(supplier)) ? null : parseInt(supplier);      from  = Date.parse(from);      to    = Date.parse(to);      controllers.invoices.listInvoices(id, code, supplier, from, to);    }  };    WMS.on('suppliers:list', function() {    WMS.navigate('suppliers');  });    WMS.on('suppliers:filter', function(criterion) {    if (criterion) {      WMS.navigate('suppliers/filter/criterion:' + criterion);    } else {      WMS.navigate('suppliers');    }  });    WMS.on('suppliers:show', function(id) {    WMS.navigate('suppliers/' + id);  });  var __handleEvent = function(baseURL, options) {    options       = (options || {});    _.defaults(options, {      from: Date.today().addMonths(-1)    , to  : Date.today()    });    var url       = [baseURL];    if (options.id) {      url.push('/id:', options.id);    }    if (options.code) {      url.push('/code:', options.code);    }    if (options.supplierId) {      url.push('/supplier:', options.supplierId);    }    url.push('/from:', options.from.toString('yyyy-MM-dd'), '/to:', options.to.toString('yyyy-MM-dd'));    WMS.navigate(url.join(""));  };  WMS.on('suppliers:estimates:list', function(options) {    __handleEvent('suppliers/estimates', options);  });    WMS.on('suppliers:orders:list', function(options) {    __handleEvent('suppliers/orders', options);  });  WMS.on('suppliers:notes:list', function(options) {    __handleEvent('suppliers/notes', options);  });    WMS.on('suppliers:invoices:list', function(options) {    __handleEvent('suppliers/invoices', options);  });    WMS.on('before:start', function() {    new Suppliers.Router({      controller: API    });  });});